# 上海地铁项目 - 前后端接口联调协议

来自: 前端开发组 (孙义宸)

为了保证前端地图和路径规划功能的正常运行，请后端严格按照以下规范提供 API 接口。

## 1. 核心配置要求 (必做)

由于我们处于开发阶段，没有配置 Nginx 反向代理，请务必在 Flask 中允许跨域请求。

- **技术要求**: 安装并配置 `flask-cors`。

- **代码示例**:
  
  ```
  from flask import Flask
  from flask_cors import CORS
  
  app = Flask(__name__)
  # 允许所有来源访问，解决前端 Axios 请求被浏览器拦截的问题
  CORS(app) 
  ```

## 2. 数据库补充要求

前端集成了 Leaflet 地图引擎，必须依赖**经纬度**才能在地图上画点。

- **要求**: 请确保数据库的 `stations` 表中，已经录入了真实的 `latitude` (纬度) 和 `longitude` (经度) 数据。
  
  - *提示*: 可以使用百度地图/高德地图的“坐标拾取器”获取坐标。
  
  - *参考格式*: 人民广场 (lat: 31.2329, lng: 121.4752)

## 3. API 接口定义

请确保接口返回的 **JSON 字段名称** 与下文完全一致（前端代码是根据这些字段名编写的）。

### 接口 A: 获取所有站点列表 (用于下拉框 & 地图撒点)

- **URL**: `/api/stations`

- **Method**: `GET`

- **功能**: 返回数据库中所有站点的基础信息。

- **响应格式 (Response JSON)**:
  
  ```
  [
      {
          "station_id": 101,            // 必须: 唯一ID (int)
          "station_name": "人民广场",    // 必须: 站点名 (string)
          "lat": 31.2329,               // 必须: 纬度 (float)
          "lng": 121.4752               // 必须: 经度 (float)
      },
      {
          "station_id": 102,
          "station_name": "徐家汇",
          "lat": 31.1906,
          "lng": 121.4366
      }
      // ... 更多站点
  ]
  ```

### 接口 B: 路径规划 (核心算法)

- **URL**: `/api/route`

- **Method**: `POST`

- **功能**: 接收起终点 ID，返回最优路径。

- **请求体 (Request JSON)**:
  
  ```
  {
      "start_station_id": 101,
      "end_station_id": 102
  }
  ```

- **响应格式 (Response JSON)**:
  
  ```
  {
      "totalTime": 35,          // 预计耗时 (分钟)
      "totalStations": 8,       // 总经过站数
      "path": [                 // 有序的路径节点数组
          {
              "station_id": 101,      // 必须: 用于地图连线
              "station_name": "人民广场",
              "line_name": "1号线",
              "transfer_line": null   // 如果不是换乘站，传 null
          },
          {
              "station_id": 105,
              "station_name": "新闸路",
              "line_name": "1号线",
              "transfer_line": null
          },
          {
              "station_id": 106,
              "station_name": "汉中路",
              "line_name": "1号线",
              "transfer_line": "12号线" // 如果需要在此站换乘，标注换乘线路
          }
      ]
  }
  ```

### 接口 C: 首页统计数据

- **URL**: `/api/stats`

- **Method**: `GET`

- **响应格式 (Response JSON)**:
  
  ```
  {
      "lineCount": 18,     // 总线路数
      "stationCount": 450  // 总站点数
  }
  ```
